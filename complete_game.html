<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>贪吃蛇游戏</title>
    <style>
        /* 核心样式 - 确保游戏可以正常显示 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #2c3e50;
            color: #ecf0f1;
            overflow-x: hidden;
        }
        .menu-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #2c3e50;
        }
        .menu-content {
            background-color: #34495e;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }
        .game-title {
            font-size: 36px;
            margin-bottom: 30px;
            color: #e74c3c;
        }
        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .menu-button {
            padding: 12px 24px;
            font-size: 18px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .menu-button:hover {
            background-color: #2980b9;
        }
        .game-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #2c3e50;
            padding: 20px;
        }
        .game-wrapper {
            background-color: #34495e;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }
        .game-board {
            background-color: #2c3e50;
            border: 2px solid #3498db;
            display: grid;
            grid-template-columns: repeat(20, 20px);
            gap: 1px;
        }
        .cell {
            width: 20px;
            height: 20px;
            background-color: #2c3e50;
        }
        .snake {
            background-color: #2ecc71;
        }
        .food {
            background-color: #e74c3c;
        }
        /* 响应式设计 */
        @media (max-width: 768px) {
            .game-title {
                font-size: 28px;
            }
            .game-board {
                grid-template-columns: repeat(15, 20px);
            }
        }
    </style>
</head>
<body>
    <div class="menu-container" id="menuContainer">
        <div class="menu-content">
            <h1 class="game-title">贪吃蛇游戏</h1>
            <div class="menu-buttons">
                <button class="menu-button" id="startButton">开始游戏</button>
                <button class="menu-button" id="settingsButton">设置</button>
                <button class="menu-button" id="historyButton">历史战绩</button>
            </div>
        </div>
    </div>

    <div class="game-container" id="gameContainer" style="display: none;">
        <div class="game-wrapper">
            <div class="game-board" id="gameBoard">
                <!-- 游戏格子将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM元素引用
            const menuContainer = document.getElementById('menuContainer');
            const gameContainer = document.getElementById('gameContainer');
            const startButton = document.getElementById('startButton');
            const settingsButton = document.getElementById('settingsButton');
            const historyButton = document.getElementById('historyButton');
            const gameBoard = document.getElementById('gameBoard');
            
            // 游戏配置
            const config = {
                gridSize: 20,
                cellSize: 20
            };
            
            // 游戏状态
            let gameState = {
                snake: [],
                food: null,
                direction: 'right',
                nextDirection: 'right',
                gameLoop: null,
                score: 0
            };
            
            // 初始化游戏板
            function initializeBoard() {
                gameBoard.style.gridTemplateColumns = `repeat(${config.gridSize}, ${config.cellSize}px)`;
                gameBoard.innerHTML = '';
                
                for (let row = 0; row < config.gridSize; row++) {
                    for (let col = 0; col < config.gridSize; col++) {
                        const cell = document.createElement('div');
                        cell.classList.add('cell');
                        cell.id = `cell-${row}-${col}`;
                        gameBoard.appendChild(cell);
                    }
                }
            }
            
            // 初始化蛇
            function initializeSnake() {
                gameState.snake = [
                    { row: 10, col: 10 },
                    { row: 10, col: 9 },
                    { row: 10, col: 8 }
                ];
                
                // 渲染初始蛇
                gameState.snake.forEach(segment => {
                    const cell = document.getElementById(`cell-${segment.row}-${segment.col}`);
                    if (cell) cell.classList.add('snake');
                });
            }
            
            // 生成食物
            function generateFood() {
                let validPosition = false;
                let newFood;
                
                while (!validPosition) {
                    newFood = {
                        row: Math.floor(Math.random() * config.gridSize),
                        col: Math.floor(Math.random() * config.gridSize)
                    };
                    
                    // 检查食物是否在蛇身上
                    validPosition = !gameState.snake.some(segment => 
                        segment.row === newFood.row && segment.col === newFood.col
                    );
                }
                
                gameState.food = newFood;
                const cell = document.getElementById(`cell-${newFood.row}-${newFood.col}`);
                if (cell) cell.classList.add('food');
            }
            
            // 更新游戏
            function update() {
                // 移动蛇
                gameState.direction = gameState.nextDirection;
                const head = { ...gameState.snake[0] };
                
                switch (gameState.direction) {
                    case 'up': head.row--; break;
                    case 'down': head.row++; break;
                    case 'left': head.col--; break;
                    case 'right': head.col++; break;
                }
                
                // 检查碰撞
                if (head.row < 0 || head.row >= config.gridSize || 
                    head.col < 0 || head.col >= config.gridSize || 
                    gameState.snake.some(segment => segment.row === head.row && segment.col === head.col)) {
                    endGame();
                    return;
                }
                
                // 检查是否吃到食物
                if (head.row === gameState.food.row && head.col === gameState.food.col) {
                    gameState.score++;
                    const foodCell = document.getElementById(`cell-${gameState.food.row}-${gameState.food.col}`);
                    if (foodCell) foodCell.classList.remove('food');
                    generateFood();
                    // 蛇长度增加（不删除尾部）
                } else {
                    // 移除尾部
                    const tail = gameState.snake.pop();
                    const tailCell = document.getElementById(`cell-${tail.row}-${tail.col}`);
                    if (tailCell) tailCell.classList.remove('snake');
                }
                
                // 添加新头部
                gameState.snake.unshift(head);
                const headCell = document.getElementById(`cell-${head.row}-${head.col}`);
                if (headCell) headCell.classList.add('snake');
            }
            
            // 开始游戏
            function startGame() {
                menuContainer.style.display = 'none';
                gameContainer.style.display = 'flex';
                
                // 重置游戏状态
                gameState = {
                    snake: [],
                    food: null,
                    direction: 'right',
                    nextDirection: 'right',
                    gameLoop: null,
                    score: 0
                };
                
                initializeBoard();
                initializeSnake();
                generateFood();
                
                // 启动游戏循环
                gameState.gameLoop = setInterval(update, 200);
            }
            
            // 结束游戏
            function endGame() {
                clearInterval(gameState.gameLoop);
                alert(`游戏结束！得分: ${gameState.score}`);
                gameContainer.style.display = 'none';
                menuContainer.style.display = 'flex';
            }
            
            // 处理键盘输入
            function handleKeyDown(event) {
                switch (event.key) {
                    case 'ArrowUp':
                        if (gameState.direction !== 'down') gameState.nextDirection = 'up';
                        break;
                    case 'ArrowDown':
                        if (gameState.direction !== 'up') gameState.nextDirection = 'down';
                        break;
                    case 'ArrowLeft':
                        if (gameState.direction !== 'right') gameState.nextDirection = 'left';
                        break;
                    case 'ArrowRight':
                        if (gameState.direction !== 'left') gameState.nextDirection = 'right';
                        break;
                    case ' ': // 空格键暂停
                        if (gameState.gameLoop) {
                            clearInterval(gameState.gameLoop);
                            gameState.gameLoop = null;
                        } else {
                            gameState.gameLoop = setInterval(update, 200);
                        }
                        break;
                }
            }
            
            // 事件监听
            startButton.addEventListener('click', startGame);
            settingsButton.addEventListener('click', () => alert('设置功能开发中'));
            historyButton.addEventListener('click', () => alert('历史战绩功能开发中'));
            document.addEventListener('keydown', handleKeyDown);
            
            // 初始化
            initializeBoard();
        });
    </script>
</body>
</html>